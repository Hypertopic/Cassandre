<!doctype html>
<html>
  <head>
    <title>{{diary_name}} - {{i18n.i_todo}}</title>
    {{>links}}
  </head>
  <body id="watermark">
    <nav id="header" class="{{>navbarstyle}} navbar-expand bd-navbar fixed-top">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item"><a class="text-light nav-link" id="diary">{{diary_name}}</a></li>
      </ul>
      {{>log}}
    </nav>
    <div id="container" class='container-fluid h-100'>
      <main class="col" id="content">
        <h1>{{i18n.i_tasklist}}</h1>
        <div id="todo">
          <h2 id='unchecked-todo' class="hidden">{{i18n.i_todo}}</h2>
          <ul>
          {{#todo}}
            <li class='unchecked-todo'>
              <span class="moment">{{date}}</span>&nbsp;–
              <a href='../../{{type}}/{{diary}}/{{id}}'>{{name}}</a>
            </li>
          {{/todo}}
          </ul>
          {{#comment}}<h2 id='unchecked-comment' class="hidden">{{i18n.i_unchecked-comment}}</h2>{{/comment}}
          <ul>
          {{#comment}}
            <li class='unchecked-comment'>
              <span class="moment">{{date}}</span>&nbsp;–
              <a href='../../{{type}}/{{diary}}/{{id}}'>{{name}}</a>
            </li>
          {{/comment}}
          </ul>
          <h2 id='draft' class="hidden">{{i18n.i_to-be-transcribed}}</h2>
          <ul>
          {{#draft}}
            <li class='draft'>
              <span class="moment">{{date}}</span>&nbsp;–
              <a href='../../{{type}}/{{diary}}/{{id}}'>{{name}}</a>
            </li>
          {{/draft}}
          </ul>
          <h2 id='unarticulated' class="hidden">{{i18n.i_to-be-articulated}}</h2>
          <ul>
          {{#diagram}}
            <li class='unarticulated'>
              <span class="moment">{{date}}</span>&nbsp;–
              <a href='../../{{type}}/{{diary}}/{{id}}'>{{name}}</a>
            </li>
          {{/diagram}}
          </ul>
          <h2 id='unnamed' class="hidden">{{i18n.i_unnamed}}</h2>
          <ul>
          {{#unnamed}}
            <li class='unnamed'>
              <span class="moment">{{date}}</span>&nbsp;–
              <a href='../../{{type}}/{{diary}}/{{id}}'>{{name}}</a>
            </li>
          {{/unnamed}}
          </ul>
          <h2 id='ungrounded' class="hidden">{{i18n.i_ungrounded}}</h2>
          <ul>
          {{#ungrounded}}
            <li class='ungrounded'>
              <span class="moment">{{date}}</span>&nbsp;–
              <a href='../../{{type}}/{{diary}}/{{id}}'>{{name}}</a>
            </li>
          {{/ungrounded}}
          </ul>
        </div>
      </main>
      <nav id="footer" class="{{>navbarstyle}} fixed-bottom">
        <a class='navbar-text' href="https://github.com/Hypertopic/Cassandre/wiki">Cassandre</a>
      </nav>
    </div>
  {{>script}}
  <script>
  $(document).ready(function() {
    moment.locale('{{locale}}');
    stickToHeader();
    momentRelative('#todo');
    if ($('.unchecked-todo').length > 0) $('#unchecked-todo').removeClass('hidden');
    if ($('.unchecked-comment').length > 0) $('#unchecked-comment').removeClass('hidden');
    if ($('.draft').length > 0) $('#draft').removeClass('hidden');
    if ($('.unarticulated').length > 0) $('#unarticulated').removeClass('hidden');
    if ($('.unnamed').length > 0) $('#unnamed').removeClass('hidden');
    if ($('.ungrounded').length > 0) $('#ungrounded').removeClass('hidden');
  });

  function momentRelative(what) {
    var moments = $(what+' .moment');
    moments.each(function() {
      var now = moment();
      var jstime = $(this).text();
      var mmtime = moment(jstime);
      if(now.diff(mmtime, 'days') <= 2) {
        $(this).text(mmtime.fromNow());
      } else if(now.diff(mmtime, 'years') <= 1) {
        $(this).text("{{i18n.i_on-a-date}}"+' '+mmtime.format("Do MMMM"));
      } else {
        $(this).text("{{i18n.i_on-a-date}}"+' '+mmtime.format("Do MMMM YYYY"));
      }
    });
    var contributions = $('ul li .moment');
    contributions.each(function() {
      $(this).text($(this).text().replace(/./, function(x) { return x.toUpperCase(); }));
    });
  }

  {{>layoutscript}}
  {{>logscript}}
  </script>
  </body>
</html>
